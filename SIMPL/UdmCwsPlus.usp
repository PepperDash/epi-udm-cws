
//Programmer: PepperDash - AC

#DEFAULT_VOLATILE
#ENABLE_STACK_CHECKING
#ENABLE_TRACE
#USER_SIMPLSHARP_LIBRARY "Pdu-UdmCws-Plus"

// Control Inputs
Digital_Input Initialize;
Digital_Input Shutdown;

// Standard Properties
String_Input StandardVersion[255];
String_Input StandardState[255];
String_Input StandardError[255];
Digital_Input StandardOccupancy;
String_Input StandardHelpRequest[255];
String_Input StandardActivity[255];

// Device Properties (1-20)
String_Input DeviceLabel[20][255];
String_Input DeviceStatusText[20][255];
String_Input DeviceDescription[20][255];
String_Input DeviceVideoSource[20][255];
String_Input DeviceAudioSource[20][255];
Analog_Input DeviceUsage[20];
String_Input DeviceError[20][255];

// Custom Properties (1-20)
String_Input PropertyLabel[20][255];
String_Input PropertyValue[20][255];

// No controller variable needed - using singleton pattern

// Initialize the CWS server
Push Initialize
{
    UdmCWSController.Initialize();
}

// Shutdown the CWS server
Push Shutdown
{
    UdmCWSController.Shutdown();
}

// Standard Properties
Change StandardVersion
{
    UdmCWSController.SetStandardVersion(StandardVersion);
}

Change StandardState
{
    UdmCWSController.SetStandardState(StandardState);
}

Change StandardError
{
    UdmCWSController.SetStandardError(StandardError);
}

Push StandardOccupancy
{
    UdmCWSController.SetStandardOccupancy(1);
}

Release StandardOccupancy
{
    UdmCWSController.SetStandardOccupancy(0);
}

Change StandardHelpRequest
{
    UdmCWSController.SetStandardHelpRequest(StandardHelpRequest);
}

Change StandardActivity
{
    UdmCWSController.SetStandardActivity(StandardActivity);
}

// Device Properties
Change DeviceLabel
{
    Integer index;
    index = GetLastModifiedArrayIndex();
    UdmCWSController.SetDeviceLabel(index, DeviceLabel[index]);
}

Change DeviceStatusText
{
    Integer index;
    index = GetLastModifiedArrayIndex();
    UdmCWSController.SetDeviceStatus(index, DeviceStatusText[index]);
}

Change DeviceDescription
{
    Integer index;
    index = GetLastModifiedArrayIndex();
    UdmCWSController.SetDeviceDescription(index, DeviceDescription[index]);
}

Change DeviceVideoSource
{
    Integer index;
    index = GetLastModifiedArrayIndex();
    UdmCWSController.SetDeviceVideoSource(index, DeviceVideoSource[index]);
}

Change DeviceAudioSource
{
    Integer index;
    index = GetLastModifiedArrayIndex();
    UdmCWSController.SetDeviceAudioSource(index, DeviceAudioSource[index]);
}

Change DeviceUsage
{
    Integer index;
    index = GetLastModifiedArrayIndex();
    UdmCWSController.SetDeviceUsage(index, DeviceUsage[index]);
}

Change DeviceError
{
    Integer index;
    index = GetLastModifiedArrayIndex();
    UdmCWSController.SetDeviceError(index, DeviceError[index]);
}

// Custom Properties
Change PropertyLabel
{
    Integer index;
    index = GetLastModifiedArrayIndex();
    UdmCWSController.SetPropertyLabel(index, PropertyLabel[index]);
}

Change PropertyValue
{
    Integer index;
    index = GetLastModifiedArrayIndex();
    UdmCWSController.SetPropertyValue(index, PropertyValue[index]);
}

function main()
{
    WaitForInitializationComplete();
    UdmCWSController.Initialize();
}

